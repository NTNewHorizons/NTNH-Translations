name: Sync main ‚Üí master (remove configs, .properties ‚Üí .lang)

on:
  schedule:
    - cron: '0 * * * *'  # –ó–∞–ø—É—Å–∫–∞—Ç—å –¢–û–õ–¨–ö–û –∏–∑ –≤–µ—Ç–∫–∏ main
  workflow_dispatch:      # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¢–û–õ–¨–ö–û –∏–∑ main

concurrency:
  group: sync-main-to-master
  cancel-in-progress: true

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout main branch
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0

      - name: Remove unnecessary files
        run: |
          # –£–¥–∞–ª—è–µ–º –ö–û–ù–§–ò–ì–ò, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω—É–∂–Ω—ã –≤ master
          if [ -f crowdin.yml ]; then
            rm crowdin.yml
            echo "‚úÖ crowdin.yml removed"
          fi

          # –£–¥–∞–ª—è–µ–º –ü–ê–ü–ö–£ –° –í–û–†–ö–§–õ–û–£ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ä–µ–∫—É—Ä—Å–∏–∏!)
          if [ -d .github ]; then
            rm -rf .github
            echo "‚úÖ .github folder removed (prevents recursion)"
          fi

      - name: Rename .properties ‚Üí .lang
        run: |
          shopt -s nullglob
          while IFS= read -r -d '' file; do
            new_name="${file%.properties}.lang"
            mv "$file" "$new_name"
            echo "üîÑ Renamed: $file ‚Üí $new_name"
          done < <(find . -type f -name "*.properties" -print0)

      - name: Configure Git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'

      - name: Commit and push to master
        run: |
          # –°–æ–∑–¥–∞—ë–º –ß–ò–°–¢–£–Æ –≤–µ—Ç–∫—É master (–±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏)
          git switch --orphan master

          git add .
          git commit -m "chore: sync from main [skip ci]" --no-verify

          # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—É—à–∏–º (–≤–µ—Ç–∫–∞ master –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ü–£–°–¢–û–ô –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
          git push origin master --force
          echo "‚úÖ Successfully synced to master"
